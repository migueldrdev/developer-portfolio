---
import { Image } from "astro:assets";
import NavbarElement from "@components/navbar/NavbarElement.astro";
import DropDown from "@components/DropDown.astro";
import DarkModeToggle from "@components/DarkModeToggle.astro";
import type { Menu } from "@interfaces/Menu";

// Importar la imagen para optimización
import miguelImage from "/public/miguelDR05.webp";

const { menu = [] } = Astro.props;

// Convertimos el menú a un estado reactivo (opcional si no se usa JS dinámico)
const menuItems = menu.map((item: Menu) => ({
  ...item,
  current: false, // Inicialmente ningún enlace está activo
}));
---

<nav
  class="fixed w-full z-20 top-0 start-0 border-b border-transparent transition-all duration-150 flex justify-center"
>
  <!-- bg-red-500 -->
  <div
    id="navbar"
    class="flex flex-wrap gap-4 items-center justify-end lg:justify-center my-2 px-6 lg:max-w-4xl md:max-w-2xl rounded-4xl rtl:space-x-reverse lg:flex-row lg:border-0"
  >
    <div class="flex lg:order-2 space-x-3 lg:space-x-0 rtl:space-x-reverse">
      <DarkModeToggle />

      <!-- Como oculto con tamaños exactos con tailwind 
        sm  = 640px
        md  = 768px
        lg  = 1024px
        xl  = 1280px
        2xl = 1536px

        Visible solo entre 400px y 800px 
        <button class="hidden min-[400px]:block max-[800px]:block lg:hidden">
          Botón específico
        </button>

        Visible solo en móviles pequeños (menor a 500px) 
        <button class="block max-[500px]:block min-[500px]:hidden">
          Móvil pequeño
        </button>

        Visible solo en tablets (entre 768px y 1024px) 
        <button class="hidden lg:block lg:hidden">
          Solo tablets
        </button>
      -->

      <button
        data-collapse-toggle="navbar-sticky"
        type="button"
        class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
        aria-controls="navbar-sticky"
        aria-expanded="false"
      >
        <span class="sr-only">Abrir menú principal</span>
        <svg
          class="w-5 h-5"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 17 14"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M1 1h15M1 7h15M1 13h15"></path>
        </svg>
      </button>
    </div>
    <div
      class="items-center justify-between hidden w-full lg:flex lg:w-auto lg:order-1"
      id="navbar-sticky"
    >
      <ul
        class="flex flex-col font-medium p-4 md:p-0 lg:p-0 mt-4 border border-gray-100 rounded-lg lg:space-x-8 rtl:space-x-reverse lg:flex-row lg:mt-0 lg:border-0"
      >
        {menuItems.map((item: Menu) => <NavbarElement {...item} />)}

        <DropDown
          label="Menú"
          items={[
            { id: "dashboard", title: "Dashboard", href: "#", current: false },
            {
              id: "more",
              title: "Más",
              items: [
                {
                  id: "overview",
                  title: "Overview",
                  href: "#",
                  current: false,
                },
                {
                  id: "my-downloads",
                  title: "My downloads",
                  href: "#",
                  current: false,
                },
                { id: "billing", title: "Billing", href: "#", current: false },
                { id: "rewards", title: "Rewards", href: "#", current: false },
              ],
              current: false,
            },
            { id: "earnings", title: "Earnings", href: "#", current: false },
            { id: "sign-out", title: "Sign out", href: "#", current: false, divider: true},
          ]}
        />
      </ul>
    </div>
  </div>
</nav>

<script is:inline>
  // Script para cambiar el navbar al hacer scroll
  function handleNavbarScroll() {
    const navbar = document.getElementById("navbar");

    if (window.scrollY > 20) {
      // Cuando hay scroll: fondo sólido
      navbar.classList.add(
        "bg-white",
        "dark:bg-gray-900",
        "border-gray-200",
        "dark:border-gray-600",
        "shadow-md"
      );
      navbar.classList.remove("border-transparent");
    } else {
      // En la parte superior: transparente
      navbar.classList.remove(
        "bg-white",
        "dark:bg-gray-900",
        "border-gray-200",
        "dark:border-gray-600",
        "shadow-md"
      );
      navbar.classList.add("border-transparent");
    }
  }

  // Ejecutar al cargar la página
  handleNavbarScroll();

  // Ejecutar al hacer scroll (con throttle para mejor performance)
  let ticking = false;
  window.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        handleNavbarScroll();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Toggle menú móvil (hamburger)
  const collapseBtn = document.querySelector(
    '[data-collapse-toggle="navbar-sticky"]'
  );
  const collapseTarget = document.getElementById("navbar-sticky");
  if (collapseBtn && collapseTarget) {
    collapseBtn.addEventListener("click", () => {
      const isHidden = collapseTarget.classList.contains("hidden");
      collapseTarget.classList.toggle("hidden", !isHidden);
      const expanded = !isHidden;
      collapseBtn.setAttribute("aria-expanded", expanded.toString());
    });
  }
</script>

<script type="module" src="src/scripts/scroll-spy.js"></script>
