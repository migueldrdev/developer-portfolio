---
import { Image } from "astro:assets";
import Badge from "@components/badges/Badge.astro";
import SocialBadge from "@components/badges/SocialBadge.astro";
import LinkBadge from "@components/badges/LinkBadge.astro";

import MailIcon from "@components/icons/Mail.astro";
import LinkedInIcon from "@components/icons/LinkedIn.astro";
import GitHub from "@components/icons/Github.astro";
import Cv from "@components/icons/Cv.astro";

// Importar la imagen para optimizaci칩n desde src/assets/
import miguelImage from "@assets/images/miguelDR05.webp";

const personalImageAlt =
  "Miguel Delgado Ruiz - Ingeniero de Software y Desarrollador Front-end";
---

<section
  id="home"
  class="scroll-section px-4 md:px-0 container pt-20 md:pt-25 scroll-m-20 w-full mx-auto lg:max-w-4xl md:max-w-2xl"
>
  <div class="w-full">
    <div class="flex gap-4 mb-4">
      <Image
        class="rounded-full shadow-lg h-20 w-20 object-cover"
        src={miguelImage}
        alt={personalImageAlt}
        width={80}
        height={80}
        loading="eager"
        fetchpriority="high"
        densities={[1, 2]}
      />
      <a
        href="https://www.linkedin.com/in/miguel05dev"
        target="_blank"
        rel="noopener"
        class="flex items-center transition md:justify-center md:hover:scale-105"
      >
        <Badge>Disponible para trabajar</Badge>
      </a>
    </div>
    <h1
      class="text-4xl font-bold tracking-tight text-gray-800 sm:text-5xl dark:text-white"
    >
      Hey!游녦, soy miguelDR05
    </h1>
    <p
      class="mt-4 text-xl text-gray-800 dark:[&>strong]:text-yellow-200 [&>strong]:text-yellow-500 [&>strong]:font-semibold dark:text-gray-300 max-w-xl"
    >
      +3 a침os de experiencia. <strong>
        Ingeniero de Software y Desarrollador Full-Stack
      </strong>de Chiclayo, Per칰 游왫릖. Convierto ideas complejas en aplicaciones
      eficientes, escalables y centradas en el usuario.
    </p>
    <!-- Sociales -->
    <div class="mt-8 flex flex-wrap gap-4 justify-start">
      <SocialBadge href="/contact" data-scroll-link>
        <MailIcon class="size-4" />
        Cont치ctame
      </SocialBadge>
      <SocialBadge
        href="https://www.linkedin.com/in/miguel05dev"
        target="_blank"
        rel="noopener"
      >
        <LinkedInIcon class="size-4" />
        LinkedIn
      </SocialBadge>
    </div>
    <!-- Links de inter칠s -->
    <div class="mt-4 flex flex-wrap gap-4 justify-start">
      <LinkBadge
        href="https://github.com/miguelDR05"
        bg="bg-purple-100"
        text="text-purple-800"
        border="border-purple-400"
        rounded="rounded-md"
        darkBg="dark:bg-gray-800"
        darkText="dark:text-purple-300"
        darkBorder="dark:border-purple-500/40"
        target="_blank"
      >
        <GitHub class="size-6" />
        GitHub
      </LinkBadge>
      <LinkBadge
        href="/CV.pdf"
        bg="bg-yellow-100"
        text="text-yellow-500"
        border="border-yellow-400"
        rounded="rounded-md"
        darkBg="dark:bg-gray-800"
        darkText="dark:text-yellow-300"
        darkBorder="dark:border-yellow-500/40"
        target="_blank"
      >
        Ver
        <Cv class="size-6" />
      </LinkBadge>
    </div>
  </div>
</section>

<script>
  /**
   * Maneja el scroll suave hacia secciones internas con URLs limpias (sin #)
   * Este script intercepta los clics en enlaces con data-scroll-link
   * y navega suavemente sin recargar la p치gina
   */
  const initHeroScrollLinks = (): void => {
    // Seleccionar todos los enlaces con el atributo data-scroll-link
    const scrollLinks = document.querySelectorAll<HTMLAnchorElement>(
      "[data-scroll-link]"
    );

    scrollLinks.forEach((link) => {
      // Crear un nuevo elemento para evitar duplicar listeners en view transitions
      const newLink = link.cloneNode(true) as HTMLAnchorElement;
      link.parentNode?.replaceChild(newLink, link);

      newLink.addEventListener("click", function (e) {
        e.preventDefault(); // Evitar navegaci칩n tradicional
        
        const href = this.getAttribute("href");
        if (!href) return;

        // Extraer el ID de la secci칩n desde la URL
        // Ejemplo: "/contact" -> "contact"
        const sectionId = href.substring(1);
        const targetElement = document.getElementById(sectionId);

        if (targetElement) {
          // Offset para compensar la altura del navbar fijo (80px)
          const headerOffset = 80;
          
          // Calcular la posici칩n del elemento
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.scrollY - headerOffset;

          // Hacer scroll suave a la secci칩n
          window.scrollTo({
            top: offsetPosition,
            behavior: "smooth",
          });

          // Actualizar URL del navegador sin recargar la p치gina
          // Esto permite que el usuario pueda compartir el enlace o usar atr치s/adelante
          window.history.pushState({ section: sectionId }, "", href);
        }
      });
    });
  };

  // Ejecutar cuando carga la p치gina
  initHeroScrollLinks();

  // Re-ejecutar cuando Astro hace transiciones de p치gina (SPA)
  document.addEventListener("astro:page-load", initHeroScrollLinks);
</script>
